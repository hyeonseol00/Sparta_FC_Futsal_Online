generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model user {
  userId   String      @id                 @map("user_id")
  userName String      @unique             @map("user_name")
  userPw   String                          @map("user_pw")
  cash      Int         @default(10000)     @map("cash")

  team      team[]
  owningPlayer owningPlayer[]
  record    record?

  @@map("user")
}

model player {
  playerId         Int        @default(autoincrement())   @map("player_id")
  playerName       String                                 @map("player_name")
  speed            Int                                    @map("speed")
  goalDecision     Int                                    @map("goal_decision")
  shootPower       Int                                    @map("shoot_power")
  defence          Int                                    @map("defence")
  stamina          Int                                    @map("stamina")
  grade            Int         @default(1)                @map("grade")

  @@id([playerId, grade])

  owningPlayer       owningPlayer[]
  
  @@map("player")
}

model owningPlayer {
  owningPlayerId    Int     @id @default(autoincrement())    @map("owning_player_id")
  userId            String                                   @map("user_id")
  playerId          Int                                      @map("player_id")
  grade             Int                                      @map("grade")
  count             Int         @default(1)                  @map("count")

  user user  @relation(fields: [userId], references: [userId], onDelete: Cascade)
  player player @relation(fields: [playerId, grade], references: [playerId, grade], onDelete: Cascade)

  defender        team[]        @relation("DefenderRelation")
  striker         team[]        @relation("StrikerRelation")
  keeper          team[]        @relation("KeeperRelation")

  @@map("owning_player")
}

model team {
  teamId      Int     @id @default(autoincrement())     @map("team_id")
  userId      String                                    @map("user_id")
  defenderId  Int                                       @map("defender_id")
  strikerId   Int                                       @map("striker_id")
  keeperId    Int                                       @map("keeper_id")

  user user  @relation(fields: [userId], references: [userId], onDelete: Cascade)
  defender owningPlayer @relation("DefenderRelation", fields: [defenderId], references: [owningPlayerId], onDelete: Cascade)
  striker owningPlayer @relation("StrikerRelation", fields: [strikerId], references: [owningPlayerId], onDelete: Cascade)
  keeper owningPlayer @relation("KeeperRelation", fields: [keeperId], references: [owningPlayerId], onDelete: Cascade)

  @@map("team")
}

model record {
  userId   String   @id              @map("user_id")
  score     Int     @default(1000)   @map("score")
  win       Int     @default(0)      @map("win")
  lose      Int     @default(0)      @map("lose")
  draw      Int     @default(0)      @map("draw")
  rank      Int                      @map("rank")
  
  user user  @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("record")
}

model matchHistory {
  matchId       Int      @id @default(autoincrement()) @map("match_id")
  userIdA       String                                @map("user_id_a")
  userIdB       String                                @map("user_id_b")
  teamIdA       Int                                   @map("team_id_a")
  teamIdB       Int                                   @map("team_id_b")
  resultA       String                                @map("result_a")
  resultB       String                                @map("result_b")
  scoreChangeA  Int                                   @map("score_change_a")
  scoreChangeB  Int                                   @map("score_change_b")
  matchTime     DateTime @default(now())              @map("match_time")

  userA user @relation("userMatches", fields: [userIdA], references: [userId])
  userB user @relation("opponentMatches", fields: [userIdB], references: [userId])
  teamA team @relation(fields: [teamIdA], references: [teamId])
  teamB team @relation(fields: [teamIdB], references: [teamId])

  @@map("match_history")
}